language: c
sudo: false

warnings_are_errors: true

addons:
  apt:
    sources:
      - r-packages-precise
    packages:
      - r-base-dev
      - r-recommended
      - pandoc
      - texinfo
      - texlive
      - texlive-latex-base
      - texlive-latex-extra
      - texlive-latex-recommended
      - texlive-fonts-recommended
      - texlive-fonts-extra
      - texlive-math-extra
      - qpdf

env:
  global:
    - R_LIBS_USER=~/R/library

cache:
  directories:
    $R_LIBS_USER

before_script:
  - mkdir -p "$R_LIBS_USER"
  - Rscript -e 'if (length(find.package("devtools", quiet = TRUE)) == 0L) { install.packages("devtools", repos = "http://cran.rstudio.com") }'
  - Rscript -e 'devtools::update_packages("devtools", repos = "http://cran.rstudio.com")'
  - Rscript -e 'devtools::install_deps(repos = "http://cran.rstudio.com", dependencies = TRUE)'
  - Rscript -e 'devtools::install_github("jimhester/covr")'
  - Rscript -e 'devtools::install_github("jimhester/lintr")'

script:
  - Rscript -e 'devtools::check(document=FALSE, build_args="--resave-data")'

after_success:
  - Rscript -e 'library(threejs); covr::codecov()'
  - Rscript -e 'library(lintr); with_defaults(open_curly_linter=NULL, line_length_linter=line_length_linter(130), camel_case_linter=NULL, snake_case_linter=NULL, infix_spaces_linter=NULL, object_usage_linter=NULL); lint_package()'
